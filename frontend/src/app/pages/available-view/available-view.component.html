<!-- Contenedor general con sombra y scroll horizontal si se desborda -->
<div class="mat-elevation-z4" style="overflow-x: auto">
  <!-- Encabezado: buscador + botón de acción + logotipo -->
  <div class="search-bar-container">
    <!-- Campo de búsqueda de texto -->
    <div>
      <mat-form-field appearance="outline" class="search-field">
        <mat-icon matPrefix>search</mat-icon>

        <!--
          Campo de entrada de texto.
          El evento (keyup) se activa al escribir.
          applyFilter filtra la tabla usando el valor ingresado.
        -->
        <input matInput (keyup)="applyFilter($event)" placeholder="Buscar" />
      </mat-form-field>
    </div>

    <!-- Contenedor del botón y logotipo a la derecha -->
    <div
      style="
        display: flex;
        justify-content: flex-end;
        width: 100%;
        align-items: center;
        padding: 0px 30px;
      "
    >
      <!-- Botón para asignar pedidos seleccionados al despacho -->
      <div style="display: flex; justify-content: center">
        <button
          mat-raised-button
          color="primary"
          (click)="addToDispatch()"
          [disabled]="selection.selected.length === 0"
        >
          <!-- Muestra la cantidad de pedidos seleccionados -->
          Asignar {{ selection.selected.length }} pedido/s a despacho
        </button>
      </div>

      <!-- Logotipo de la empresa -->
      <div>
        <img src="assets/vivipra.png" alt="vivipra" style="width: 100px" />
      </div>
    </div>
  </div>

  <!-- Contenedor de la tabla en escritorio -->
  <div class="desktop-view">
    <!--
      Componente Angular Material para tablas.
      [dataSource]="dataSource": enlaza los datos a mostrar.
      matSort: habilita ordenamiento por columnas (debe estar configurado en el .ts con MatSort).
    -->
    <table mat-table [dataSource]="dataSource" class="mat-table" matSort>
      <!-- Columna de selección múltiple con checkboxes -->
      <ng-container matColumnDef="select">
        <!-- Celda de encabezado con checkbox para seleccionar todas las filas visibles -->
        <th mat-header-cell *matHeaderCellDef>
          <mat-checkbox
            (change)="toggleAllRows($event)"
            [checked]="isAllSelected()"
            [indeterminate]="selection.hasValue() && !isAllSelected()"
          ></mat-checkbox>
        </th>

        <!-- Celda por cada fila con su checkbox -->
        <td mat-cell *matCellDef="let row">
          <!--
            mat-cell: celda de contenido.
            *matCellDef="let row": crea una variable 'row' que representa el objeto de esa fila.
            selection.isSelected(row): true si esa fila está seleccionada.
          -->
          <mat-checkbox
            (click)="$event.stopPropagation()"
            (change)="toggleRow(row)"
            [checked]="selection.isSelected(row)"
          ></mat-checkbox>
        </td>
      </ng-container>

      <!-- Columna: Folio -->
      <ng-container matColumnDef="FolioNum">
        <th mat-header-cell *matHeaderCellDef>Folio</th>
        <!--
          let usuario: define el contexto de la fila.
          usuario.FolioNum: accede al campo 'FolioNum' del objeto.
        -->
        <td mat-cell *matCellDef="let usuario">{{ usuario.FolioNum }}</td>
      </ng-container>

      <!-- Columna: Código del Cliente -->
      <ng-container matColumnDef="CodCliente">
        <th mat-header-cell *matHeaderCellDef>Código Cliente</th>
        <td mat-cell *matCellDef="let usuario">{{ usuario["Cod.Cliente"] }}</td>
      </ng-container>

      <!-- Columna: Nombre del Cliente -->
      <ng-container matColumnDef="NombreCliente">
        <th mat-header-cell *matHeaderCellDef>Nombre Cliente</th>
        <td mat-cell *matCellDef="let usuario">{{ usuario.NombreCliente }}</td>
      </ng-container>

      <!-- Columna: Fecha del documento -->
      <ng-container matColumnDef="FechaDocumento">
        <!-- mat-sort-header: permite ordenar por esta columna -->
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Fecha</th>
        <td mat-cell *matCellDef="let usuario">
          {{ usuario.FechaDocumento | date : "dd/MM/yyyy" }}
        </td>
      </ng-container>

      <!-- Columna: Hora de creación -->
      <ng-container matColumnDef="HoraCreacion">
        <th mat-header-cell *matHeaderCellDef>Hora</th>
        <td mat-cell *matCellDef="let usuario">
          <!-- Pipe personalizado para formatear hora -->
          {{ usuario.HoraCreacion | formatTime }}
        </td>
      </ng-container>

      <!-- Columna: Dirección -->
      <ng-container matColumnDef="Direccion">
        <th mat-header-cell *matHeaderCellDef>Dirección</th>
        <td mat-cell *matCellDef="let usuario">{{ usuario.Direccion }}</td>
      </ng-container>

      <!-- Columna: Comentarios -->
      <ng-container matColumnDef="Comentarios">
        <th mat-header-cell *matHeaderCellDef>Comentarios</th>
        <td mat-cell *matCellDef="let usuario">
          {{
            usuario.Comentarios.length ? usuario.Comentarios : "Sin comentarios"
          }}
        </td>
      </ng-container>

      <!--
        Fila del encabezado de la tabla.
        *matHeaderRowDef="displayedColumns":
        Renderiza la fila con las columnas definidas en el array 'displayedColumns' del .ts.
      -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>

      <!--
        Fila de datos por cada objeto en el dataSource.
        let row: referencia al objeto actual.
        columns: displayedColumns → columnas visibles.
      -->
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <!--
      Paginador de Angular Material.
      [pageSize]="8": número de filas por página (por defecto).
      [pageSizeOptions]="[10, 15, 20]": opciones seleccionables por el usuario.
      showFirstLastButtons: muestra flechas para saltar al inicio/final.
    -->
    <mat-paginator
      [pageSize]="8"
      [pageSizeOptions]="[10, 15, 20]"
      showFirstLastButtons
    ></mat-paginator>
  </div>
</div>
